import styles from "./page.module.css";
import RoomSlider from "./RoomSlider";
import { FaStar } from "react-icons/fa";
import BookingForm from "./formroom";
import RoomReviews from "./roomreviews";
import RoomHome from "./roomcard";    
interface Room {
  id: number;
  name: string;
  price: number;
  rating?: number;
  description: string;
  images?: string[];
  services?: string;
  size?: number;
  bed?: string;
  capacity?: number;
  lat?: number;
  lng?: number;
}

interface RoomPageProps {
  params: {
    roomid: string;
  };
}

export default async function RoomPage(props: {
  params: Promise<{ roomid: string }>;
}) {
  const { roomid } = await props.params;
  const res = await fetch(
    `https://paleturquoise-beaver-156875.hostingersite.com/api_php/room.php/${roomid}`,
    {
      next: { revalidate: 60 },
    }
  );


  if (!res.ok) {
    return (
      <div>
        <h3>حدث خطأ أثناء تحميل بيانات الغرفة.</h3>
      </div>
    );
  }

  const room: Room = await res.json();

  
  const mapSrc = `https://www.google.com/maps?q=${room.lat || 21.422617721535033},${room.lng || 39.826315101937865}&hl=ar&z=15&output=embed`;
  const mapSrcMobile = `https://www.google.com/maps/search/?api=1&query=${room.lat || 21.422617721535033},${room.lng || 39.826315101937865}&hl=ar`;
  const services = room.services?.split(",");

  return (
    <div className={styles.mainContainer}>
        <div className={`${styles.container} container`}>
        <div className={styles.titlePage}>
          <h1>تفاصيل الغرفة</h1>
          <p>راحة الحجاج هي أولويتنا دائمًا، نقدم لك تجربة إقامة مميزة ومريحة.</p>
        </div>
        <div className={styles.mainImage}>
            <RoomSlider 
             slides={room.images ? [{
             images: room.images,
             title: room.name
             }] : []} 
               />
          <div className={styles.mapContainer}>
            <a href={mapSrcMobile} target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><path d="M128 252.6C128 148.4 214 64 320 64C426 64 512 148.4 512 252.6C512 371.9 391.8 514.9 341.6 569.4C329.8 582.2 310.1 582.2 298.3 569.4C248.1 514.9 127.9 371.9 127.9 252.6zM320 320C355.3 320 384 291.3 384 256C384 220.7 355.3 192 320 192C284.7 192 256 220.7 256 256C256 291.3 284.7 320 320 320z"/></svg>موقع رائع - اعرض الخارطة</a>
            <iframe
              src={mapSrc}
              width="100%"
              height="100%"
              style={{ border: 0 }}
              loading="lazy"
              allowFullScreen>
            </iframe>
          </div>
        </div>
        <div className={styles.detailsContainer}> 
         <div className={styles.roomInfo}>
          <div className={styles.ratingContainer}>
            <h2 className={styles.nameRoom}>{room.name} </h2>
            <p className={styles.rating}>
              <FaStar className={styles.star} /> {room.rating ?? "4.8"}
            </p>
          </div>
          <p className={styles.price}> {room.price} ريال <span>/ليلة</span></p>
          <p className={styles.description}>{room.description}</p>
          <div className={styles.servicesContainer}>
            <h2>الخدمات</h2>
            <div className={styles.services}>
            {services?.map((service, index) => (
              <div key={index} className={styles.serviceItem}>
                <span>{service.trim()}</span>
                {service.includes("فاي") && <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="50px"><path d="M14.25 18.75a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0m1.5 0a3.75 3.75 0 1 0-7.5 0 3.75 3.75 0 0 0 7.5 0m2.08-5.833a8.25 8.25 0 0 0-11.666 0 .75.75 0 0 0 1.06 1.06 6.75 6.75 0 0 1 9.546 0 .75.75 0 0 0 1.06-1.06m3.185-3.182c-4.979-4.98-13.051-4.98-18.03 0a.75.75 0 1 0 1.06 1.06c4.394-4.393 11.516-4.393 15.91 0a.75.75 0 1 0 1.06-1.06m2.746-3.603C17.136-.043 6.864-.043.24 6.132A.75.75 0 1 0 1.26 7.23c6.05-5.638 15.429-5.638 21.478 0a.75.75 0 0 0 1.022-1.098z"></path></svg>}
                {service.includes("إفطار") && <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="50px"><path d="M3.75 4.5h12a.75.75 0 0 1 .75.75v7.5a6.75 6.75 0 0 1-13.5 0v-7.5a.75.75 0 0 1 .75-.75m0-1.5A2.25 2.25 0 0 0 1.5 5.25v7.5a8.25 8.25 0 0 0 16.5 0v-7.5A2.25 2.25 0 0 0 15.75 3zm-3 18h22.5a.75.75 0 0 0 0-1.5H.75a.75.75 0 0 0 0 1.5m16.5-15h1.5a3.763 3.763 0 0 1 3.75 3.752 3.76 3.76 0 0 1-3.752 3.748H17.1a.75.75 0 0 0 0 1.5h1.65A5.263 5.263 0 0 0 24 9.752 5.264 5.264 0 0 0 18.752 4.5H17.25a.75.75 0 0 0 0 1.5"></path></svg>}
                {service.includes("مرافق") &&<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="50px"><path d="M13.125 3.56a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0m1.5 0a3.375 3.375 0 1 0-6.75 0 3.375 3.375 0 0 0 6.75 0m3.454 18.335-1.836-3.67a.75.75 0 0 0-.671-.415H11.25a.75.75 0 0 1-.75-.75v-7.5a.75.75 0 0 1 1.5 0v6c0 .414.336.75.75.75h3.75a.75.75 0 0 1 .671.415l2.25 4.5a.75.75 0 0 1-1.342.67m-1.342.671a2.25 2.25 0 1 0 4.026-2.012l-2.25-4.5A2.25 2.25 0 0 0 16.5 14.81h-3.75l.75.75v-6a2.25 2.25 0 0 0-4.5 0v7.5a2.25 2.25 0 0 0 2.25 2.25h4.322l-.67-.415 1.835 3.672zm-4.362-.958a5.25 5.25 0 0 1-5.25-9.096.75.75 0 1 0-.75-1.299 6.75 6.75 0 1 0 6.75 11.694.75.75 0 1 0-.75-1.3z"></path></svg>}
                {service.includes("مطعمان") && <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="50px"><path d="M5.999.75v22.5a.75.75 0 0 0 1.5 0V.75a.75.75 0 0 0-1.5 0m3 0V7.5a2.26 2.26 0 0 1-2.252 2.25 2.26 2.26 0 0 1-2.248-2.252V.75a.75.75 0 0 0-1.5 0V7.5a3.76 3.76 0 0 0 3.748 3.75 3.76 3.76 0 0 0 3.752-3.748V.75a.75.75 0 0 0-1.5 0m6.75 15.75h3c1.183.046 2.203-.9 2.25-2.111a2 2 0 0 0 0-.168c-.25-6.672-.828-9.78-3.231-13.533a1.508 1.508 0 0 0-2.77.81V23.25a.75.75 0 0 0 1.5 0V1.503c0 .003.001 0 .003 0l.008.002c2.21 3.45 2.75 6.354 2.99 12.773v.053a.696.696 0 0 1-.721.67L15.749 15a.75.75 0 0 0 0 1.5"></path></svg>}
                {service.includes("خدمة") && <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="50px"><path d="M4.5 11.579a8.25 8.25 0 1 1 16.5 0l.75-.75h-18zm-1.5 0c0 .414.336.75.75.75h18a.75.75 0 0 0 .75-.75c0-5.385-4.365-9.75-9.75-9.75S3 6.194 3 11.579m-.75.75h21a.75.75 0 0 0 0-1.5h-21a.75.75 0 0 0 0 1.5M12 1.079v1.5a.75.75 0 0 0 1.5 0v-1.5a.75.75 0 0 0-1.5 0M1.273 22.616l3.75-3.65-1.011.032 5.25 4.5a.75.75 0 0 0 .927.039l12.062-8.711a1.92 1.92 0 0 0-.136-3.203 5.25 5.25 0 0 0-5.25-.088l-2.929 1.625a3.85 3.85 0 0 1-4.543-.646l-.587-.587a3.75 3.75 0 0 0-4.326-.698 1.606 1.606 0 0 0-.417 2.57l.459.46a3.75 3.75 0 0 1 1.02 3.384l-.371 1.842a.75.75 0 0 0 1.47.296l.372-1.843a5.25 5.25 0 0 0-1.43-4.74l-.459-.458a.106.106 0 0 1 .028-.17 2.25 2.25 0 0 1 2.595.42l.59.588a5.35 5.35 0 0 0 6.322.897l2.934-1.628a3.75 3.75 0 0 1 3.75.062.42.42 0 0 1 .03.7L9.311 22.322l.927.039-5.25-4.5a.75.75 0 0 0-1.011.032l-3.75 3.65a.75.75 0 1 0 1.046 1.074z"></path></svg>}
                {service.includes("عائلية") && <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="50px"><path d="M21.75 5.25a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0m1.5 0a3.75 3.75 0 1 0-7.5 0 3.75 3.75 0 0 0 7.5 0m-6.182 15.093.188 1.5A.75.75 0 0 0 18 22.5h3a.75.75 0 0 0 .744-.657l.75-6-.744.657h1.5a.75.75 0 0 0 .75-.75V13.5a4.5 4.5 0 0 0-7.2-3.6.75.75 0 1 0 .9 1.2 3 3 0 0 1 4.8 2.4v2.25l.75-.75h-1.5a.75.75 0 0 0-.744.657l-.75 6L21 21h-3l.744.657-.188-1.5a.75.75 0 0 0-1.488.186M6.75 5.25a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0m1.5 0a3.75 3.75 0 1 0-7.5 0 3.75 3.75 0 0 0 7.5 0M5.444 20.157l-.188 1.5L6 21H3l.744.657-.75-6A.75.75 0 0 0 2.25 15H.75l.75.75V13.5a3 3 0 0 1 4.8-2.4.75.75 0 1 0 .9-1.2A4.5 4.5 0 0 0 0 13.5v2.25c0 .414.336.75.75.75h1.5l-.744-.657.75 6A.75.75 0 0 0 3 22.5h3a.75.75 0 0 0 .744-.657l.188-1.5a.75.75 0 0 0-1.488-.186M13.5 9a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0M15 9a3 3 0 1 0-6 0 3 3 0 0 0 6 0m-3 3a4.5 4.5 0 0 0-4.5 4.5v.75c0 .414.336.75.75.75h1.5l-.74-.627.75 4.5a.75.75 0 0 0 .74.627H12a.75.75 0 0 0 0-1.5h-1.5l.74.627-.75-4.5a.75.75 0 0 0-.74-.627h-1.5l.75.75v-.75a3 3 0 0 1 3-3 .75.75 0 0 0 0-1.5m0 1.5a3 3 0 0 1 3 3v.75l.75-.75h-1.5a.75.75 0 0 0-.74.627l-.75 4.5.74-.627H12a.75.75 0 0 0 0 1.5h1.5a.75.75 0 0 0 .74-.627l.75-4.5-.74.627h1.5a.75.75 0 0 0 .75-.75v-.75A4.5 4.5 0 0 0 12 12a.75.75 0 0 0 0 1.5"></path></svg>}
                {service.includes("إطلاله") && <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="50px"><path d="M12.013 4.501c-3.88-.065-8.202 2.372-11.39 5.88a2.414 2.414 0 0 0-.001 3.232c3.183 3.506 7.481 5.95 11.39 5.885 3.885.066 8.183-2.378 11.367-5.883.83-.92.83-2.314.002-3.232-3.194-3.512-7.515-5.947-11.394-5.882zm0 1.5c3.378-.057 7.328 2.17 10.256 5.389.31.344.31.872-.002 1.219-2.92 3.213-6.848 5.446-10.254 5.39-3.432.056-7.36-2.178-10.279-5.392a.91.91 0 0 1 .002-1.22c2.922-3.216 6.872-5.443 10.251-5.386zM15 12a3 3 0 1 1-6 .004 3 3 0 0 1 6-.007zm1.5 0v-.003a4.5 4.5 0 1 0-9-.002 4.5 4.5 0 0 0 9 .005"></path></svg>}
                {service.includes("حوض") && <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="50px"><path d="M12.75 15h10.5l-.74-.873-.664 3.986a5.25 5.25 0 0 1-5.179 4.387H7.333a5.25 5.25 0 0 1-5.18-4.387l-.663-3.986L.75 15h4.5a.75.75 0 0 0 0-1.5H.75a.75.75 0 0 0-.74.873l.664 3.986A6.75 6.75 0 0 0 7.334 24h9.333a6.75 6.75 0 0 0 6.659-5.64l.664-3.987a.75.75 0 0 0-.74-.873h-10.5a.75.75 0 0 0 0 1.5M12 19.5H6v-5.25a.75.75 0 0 1 .75-.75h4.5a.75.75 0 0 1 .75.75zm0 1.5a1.5 1.5 0 0 0 1.5-1.5v-5.25A2.25 2.25 0 0 0 11.25 12h-4.5a2.25 2.25 0 0 0-2.25 2.25v5.25A1.5 1.5 0 0 0 6 21zm4.5-17.25a2.25 2.25 0 0 1 4.5 0v10.5a.75.75 0 0 0 1.5 0V3.75a3.75 3.75 0 1 0-7.5 0 .75.75 0 0 0 1.5 0m-3 3a2.25 2.25 0 0 1 4.5 0l.75-.75h-6zm-1.5 0c0 .414.336.75.75.75h6a.75.75 0 0 0 .75-.75 3.75 3.75 0 1 0-7.5 0"></path></svg>}
                {service.includes("موقف") && <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128" width="50px"><path d="M127.75 55.27C122.884 20.221 90.527-4.247 55.478.62 20.43 5.484-4.039 37.841.828 72.89 4.996 102.925 29.648 125.923 59.9 128h.28a4.002 4.002 0 1 0 .27-8C29.556 117.884 6.226 91.124 8.342 60.23S37.22 6.006 68.112 8.122C94.594 9.936 116.175 30.07 119.82 56.36a4.003 4.003 0 0 0 7.93-1.1zM68.28 38.71h-12a4 4 0 0 0-4 4v48.06a4 4 0 0 0 8 0v-20h8c8.837 0 16-7.163 16-16s-7.163-16-16-16zm0 24h-8v-16h8a8 8 0 1 1 0 16m36.04 29.39h8a4 4 0 0 0 0-8h-4v-4a4 4 0 0 0-8 0v4a8 8 0 0 0-8 8c0 6.48 5.91 9.43 10.22 11.59 3.4 1.7 5.8 3 5.8 4.43h-12a4 4 0 0 0 0 8h4v4a4 4 0 0 0 8 0v-4a8 8 0 0 0 8-8c0-6.48-5.91-9.43-10.22-11.59-3.39-1.69-5.8-3-5.79-4.43h4z"></path></svg>}
                {service.includes("مطبخ") && <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="50px"><path d="M2.25 2.25h19.5L21 1.5v21l.75-.75H2.25l.75.75v-21zm0-1.5a.75.75 0 0 0-.75.75v21c0 .414.336.75.75.75h19.5a.75.75 0 0 0 .75-.75v-21a.75.75 0 0 0-.75-.75zm-1.5 1.5h22.5a.75.75 0 0 0 0-1.5H.75a.75.75 0 0 0 0 1.5m0 21h22.5a.75.75 0 0 0 0-1.5H.75a.75.75 0 0 0 0 1.5M18 15v3.539a.21.21 0 0 1-.211.211H6.211A.21.21 0 0 1 6 18.539v-7.078a.21.21 0 0 1 .211-.211h11.578c.116 0 .211.095.211.211zm1.5 0v-3.539a1.71 1.71 0 0 0-1.711-1.711H6.211A1.71 1.71 0 0 0 4.5 11.461v7.078a1.71 1.71 0 0 0 1.711 1.711h11.578a1.71 1.71 0 0 0 1.711-1.711zM9 14.25h6a.75.75 0 0 0 0-1.5H9a.75.75 0 0 0 0 1.5M5.25 4.875a.375.375 0 1 1 0-.75.375.375 0 0 1 0 .75.75.75 0 0 0 0-1.5 1.125 1.125 0 1 0 0 2.25 1.125 1.125 0 0 0 0-2.25.75.75 0 0 0 0 1.5m3 0a.375.375 0 1 1 0-.75.375.375 0 0 1 0 .75.75.75 0 0 0 0-1.5 1.125 1.125 0 1 0 0 2.25 1.125 1.125 0 0 0 0-2.25.75.75 0 0 0 0 1.5m-6 3.375h19.5a.75.75 0 0 0 0-1.5H2.25a.75.75 0 0 0 0 1.5m11.25-3h5.25a.75.75 0 0 0 0-1.5H13.5a.75.75 0 0 0 0 1.5"></path></svg>}
              </div>
            ))}
            </div>
          </div> 
          <RoomReviews roomId={room.id} />  
         </div>
         <div className={styles.bookingContainer}>
          <BookingForm />
         </div>
       </div>
       <RoomHome />
      </div>
    </div>
  );
}